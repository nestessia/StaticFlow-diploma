@startuml
' Группировка основных компонентов
package "Ядро системы" {
    class ПарсерМенеджер {
        - парсеры: Словарь[расширение: строка, парсер: Парсер]
        + __init__()
        + добавить_парсер(расширение: строка, парсер: Парсер)
        + получить_парсер(расширение: строка): Парсер
        + определить_парсер_по_расширению(расширение: строка): Парсер
        + вывести_ошибку_отсутствия_парсера(расширение: строка)
    }

    class Движок {
        - конфигурация: Конфигурация
        - сайт: Сайт
        - _кэш: словарь
        - парсер_менеджер: ПарсерМенеджер
        - плагины: Список[Плагин]
        + __init__(конфигурация: Конфигурация)
        + добавить_плагин(плагин: Плагин)
        + добавить_парсер(расширение: строка, парсер: Парсер)
        + инициализировать(исходная_папка: Путь, выходная_папка: Путь, папка_шаблонов: Путь)
        + собрать()
        - _обработать_страницы()
        - _обработать_страницу(страница: Страница)
        - _копировать_статические_файлы()
        + очистить()
    }

    class Сайт {
        - конфигурация: Конфигурация
        - исходная_папка: Путь
        - выходная_папка: Путь
        - папка_шаблонов: Путь
        - страницы: Список[Страница]
        + __init__(конфигурация: Конфигурация)
        + установить_папки()
        + загрузить_страницы()
        + получить_все_страницы()
        + очистить()
    }

    class Конфигурация {
        - настройки: словарь
        + __init__(путь_конфигурации: Путь)
        + загрузить()
        + получить(ключ: строка)
        + установить(ключ: строка, значение: любой)
    }

    class Кэш {
        - _кэш: словарь
        - _время_жизни: число
        - _максимальный_размер: число
        + __init__(время_жизни: число = 3600, максимальный_размер: число = 1000)
        + получить(ключ: строка): любой
        + установить(ключ: строка, значение: любой, время_жизни: число = None)
        + удалить(ключ: строка)
        + очистить()
        + проверить_срок_действия(ключ: строка): булево
        + получить_статистику(): словарь
    }
}

' Группировка контента
package "Управление контентом" {
    class Страница {
        - путь_исходника: Путь
        - путь_выхода: Путь
        - содержимое: строка
        - метаданные: словарь
        - заголовок: строка
        - формат: строка
        - история: ИсторияИзменений
        + __init__(путь_исходника: Путь)
        + отрендерить(шаблон: строка)
        + загрузить()
        + получить_формат(): строка
        + получить_кэшированное_содержимое(): строка
        + сохранить_в_кэш(содержимое: строка, время_жизни: число)
        + добавить_в_историю(контент: строка, автор: строка)
        + откатить_к_версии(id: строка)
    }

    class ИсторияИзменений {
        - страница: Страница
        - версии: Список[Версия]
        + добавить_версию(контент: строка)
        + получить_версию(id: строка)
        + получить_все_версии()
    }

    class Версия {
        - id: строка
        - дата: дата
        - автор: строка
        - контент: строка
        + сравнить_с(версия: Версия)
    }
}

' Группировка расширений
package "Расширения" {
    interface Парсер {
        + движок: Движок
        + инициализировать()
        + разобрать(содержимое: строка): словарь
        + преобразовать(содержимое: строка): строка
        + получить_метаданные(): словарь
        + очистить()
    }

    interface Плагин {
        + движок: Движок
        + инициализировать()
        + обработать_страницу(страница: Страница)
        + обработать_сайт(сайт: Сайт)
        + обработать_контент(контент: строка): строка
        + получить_заголовок(): строка
        + очистить()
        + получить_кэшированный_результат(ключ: строка): любой
        + сохранить_в_кэш(ключ: строка, значение: любой, время_жизни: число)
    }
}

' Группировка интерфейсов
package "Интерфейсы управления" {
    class Сервер {
        - движок: Движок
        - хост: строка
        - порт: число
        + запустить()
        + остановить()
    }

    class CLI {
        - движок: Движок
        + разобрать_аргументы()
        + выполнить_команду()
    }

    class Админка {
        - движок: Движок
        - конфигурация: Конфигурация
        + запустить()
        + остановить()
        + получить_страницы()
        + сохранить_страницу()
        + получить_настройки_темы()
        + сохранить_настройки_темы()
    }
}

' Группировка темы
package "Оформление" {
    class Тема {
        - название: строка
        - настройки: словарь
        - шаблоны: Список[Шаблон]
        + загрузить()
        + сохранить()
        + получить_настройку()
        + установить_настройку()
    }

    class Шаблон {
        - название: строка
        - содержимое: строка
        - переменные: Список[строка]
        + отрендерить(данные: словарь)
        + получить_переменные()
    }
}

' Группировка деплоя
package "Публикация" {
    interface Деплой {
        + движок: Движок
        + инициализировать()
        + настроить(настройки: словарь)
        + опубликовать()
        + получить_статус(): строка
    }

    class GithubPagesDeploy {
        - репозиторий: строка
        - ветка: строка
        - токен: строка
        + настроить(настройки: словарь)
        + опубликовать()
        + получить_статус(): строка
    }
}

' Группировка редактирования
package "Редактирование" {
    class Редактор {
        - страница: Страница
        - кэш: Кэш
        + сохранить_изменения(контент: строка)
        + получить_предпросмотр(): строка
        + получить_историю_изменений()
        + откатить_изменения(версия: строка)
        + получить_кэшированный_предпросмотр(): строка
        + сохранить_предпросмотр_в_кэш(содержимое: строка)
    }
}

' Связи остаются те же
Движок "1" *-- "1" Сайт
Движок "1" *-- "1" Конфигурация
Движок "1" *-- "1" Кэш
Движок "1" *-- "1" ПарсерМенеджер
Движок "1" o-- "*" Плагин
ПарсерМенеджер "1" o-- "*" Парсер
Сайт "1" *-- "*" Страница
Сервер "1" *-- "1" Движок
CLI "1" *-- "1" Движок
Админка "1" *-- "1" Движок
Тема "1" *-- "*" Шаблон
Движок "1" o-- "1" Деплой
GithubPagesDeploy --|> Деплой
Админка "1" *-- "1" Редактор
Страница "1" *-- "1" ИсторияИзменений
ИсторияИзменений "1" *-- "*" Версия
Страница "1" o-- "1" Кэш
Плагин "1" o-- "1" Кэш

@enduml